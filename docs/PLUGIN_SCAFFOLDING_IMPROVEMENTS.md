# æ’ä»¶è„šæ‰‹æ¶å·¥å…·æ”¹è¿›å»ºè®®

åŸºäº JpsPlanner è¿ç§»éªŒè¯çš„ç»éªŒï¼Œæœ¬æ–‡æ¡£æ€»ç»“äº†æ’ä»¶è„šæ‰‹æ¶å·¥å…·çš„æ”¹è¿›å»ºè®®ã€‚

---

## ğŸ“Š å½“å‰çŠ¶æ€è¯„ä¼°

### âœ… å·¥å…·å·²ç»åšå¾—å¾ˆå¥½çš„åœ°æ–¹

1. **å®Œæ•´çš„ä¸‰å±‚æ¶æ„æ¨¡æ¿**
   - âœ… `algorithm/` å±‚ï¼šæä¾›äº†æ¸…æ™°çš„ç®—æ³•æ¥å£ç¤ºä¾‹
   - âœ… `adapter/` å±‚ï¼šæä¾›äº†å®Œæ•´çš„å¹³å°é€‚é…å™¨å®ç°
   - âœ… æ³¨å†Œæœºåˆ¶ï¼šåŒé‡æ³¨å†Œï¼ˆåŠ¨æ€ + é™æ€ï¼‰

2. **è‰¯å¥½çš„ä»£ç ç»„ç»‡**
   - âœ… æ¸…æ™°çš„ç›®å½•ç»“æ„
   - âœ… è¯¦ç»†çš„æ³¨é‡Šå’Œæ–‡æ¡£
   - âœ… ç¬¦åˆ C++17 æ ‡å‡†

3. **å®Œå–„çš„æ„å»ºé…ç½®**
   - âœ… CMakeLists.txt ç»“æ„æ¸…æ™°
   - âœ… æ”¯æŒå®‰è£…å’Œå¯¼å‡º
   - âœ… ç‰ˆæœ¬ç®¡ç†

### âŒ éœ€è¦æ”¹è¿›çš„åœ°æ–¹

| é—®é¢˜ | å½±å“ | ä¼˜å…ˆçº§ | çŠ¶æ€ |
|------|------|--------|------|
| `register.cpp` å¤´æ–‡ä»¶è·¯å¾„é”™è¯¯ | ç¼–è¯‘å¤±è´¥ | ğŸ”´ é«˜ | âœ… å·²ä¿®å¤ |
| ç¼ºå°‘å¹³å°åŒ…å«è·¯å¾„ | ç¼–è¯‘å¤±è´¥ | ğŸ”´ é«˜ | âœ… å·²ä¿®å¤ |
| ç¼ºå°‘å¸¸è§ä¾èµ–çš„æ³¨é‡Š | é…ç½®å›°éš¾ | ğŸŸ¡ ä¸­ | âœ… å·²ä¿®å¤ |
| `adapter/` å±‚æœªç»éªŒè¯ | ä¸ç¡®å®šæ€§ | ğŸŸ¡ ä¸­ | âš ï¸ å¾…éªŒè¯ |
| ç¼ºå°‘å•å…ƒæµ‹è¯•æ¨¡æ¿ | æµ‹è¯•å›°éš¾ | ğŸŸ¢ ä½ | â³ å¾…å®ç° |

---

## ğŸ”§ å·²å®æ–½çš„æ”¹è¿›

### æ”¹è¿› 1: ä¿®å¤ `register.cpp` å¤´æ–‡ä»¶è·¯å¾„ âœ…

**é—®é¢˜**: æ¨¡æ¿ä½¿ç”¨äº†ä¸å­˜åœ¨çš„å¤´æ–‡ä»¶
```cpp
#include "plugin/framework/planner_plugin_registry.hpp"  // âŒ ä¸å­˜åœ¨
```

**ä¿®å¤**:
```cpp
#include "plugin/framework/plugin_registry.hpp"  // âœ… æ­£ç¡®
```

**å½±å“**: æ‰€æœ‰æ–°åˆ›å»ºçš„æ’ä»¶éƒ½èƒ½æ­£ç¡®ç¼–è¯‘

---

### æ”¹è¿› 2: æ·»åŠ å¹³å°åŒ…å«è·¯å¾„ âœ…

**é—®é¢˜**: CMakeLists.txt ç¼ºå°‘å¿…éœ€çš„å¹³å°å¤´æ–‡ä»¶è·¯å¾„

**ä¿®å¤**:
```cmake
target_include_directories({{PLUGIN_NAME_SNAKE}}_plugin
    PRIVATE
        ${CMAKE_SOURCE_DIR}/platform/include  # âœ… æ·»åŠ 
)
```

**å½±å“**: æ’ä»¶å¯ä»¥è®¿é—®å¹³å°æ¥å£å®šä¹‰

---

### æ”¹è¿› 3: æ·»åŠ å¸¸è§ä¾èµ–çš„æ³¨é‡Šè¯´æ˜ âœ…

**é—®é¢˜**: ç”¨æˆ·ä¸çŸ¥é“å¦‚ä½•æ·»åŠ å¸¸è§ä¾èµ–ï¼ˆBoostã€OpenCVã€ESDF ç­‰ï¼‰

**ä¿®å¤**: åœ¨ CMakeLists.txt ä¸­æ·»åŠ è¯¦ç»†æ³¨é‡Š
```cmake
# ========== ä¾èµ–é¡¹ ==========
# Uncomment if you need additional dependencies:
# find_package(Boost REQUIRED)              # For advanced data structures
# find_package(OpenCV REQUIRED)             # For image processing
# find_package(PCL REQUIRED)                # For point cloud processing

target_link_libraries({{PLUGIN_NAME_SNAKE}}_plugin
    PRIVATE
        Eigen3::Eigen
        # Boost::boost                        # Uncomment if using Boost
        # ${OpenCV_LIBS}                      # Uncomment if using OpenCV
        # esdf_builder_plugin                 # Uncomment if you need ESDF map
        # grid_map_builder_plugin             # Uncomment if you need occupancy grid
)
```

**å½±å“**: ç”¨æˆ·å¯ä»¥è½»æ¾æ·»åŠ å¸¸è§ä¾èµ–ï¼Œæ— éœ€æŸ¥é˜…æ–‡æ¡£

---

## ğŸ¯ å¾…å®æ–½çš„æ”¹è¿›å»ºè®®

### ğŸ”´ é«˜ä¼˜å…ˆçº§

#### å»ºè®® 1: éªŒè¯ç”Ÿæˆçš„ `adapter/` å±‚ä»£ç 

**é—®é¢˜**: åœ¨ JpsPlanner éªŒè¯ä¸­ï¼Œæˆ‘ä»¬**æ²¡æœ‰ä½¿ç”¨**å·¥å…·ç”Ÿæˆçš„ `adapter/` ä»£ç ï¼Œè€Œæ˜¯å¤åˆ¶äº†æ—§æ’ä»¶çš„ä»£ç ã€‚

**å»ºè®®**: åˆ›å»ºä¸€ä¸ªç®€å•çš„æ–°æ’ä»¶ï¼ˆä¸è¿ç§»ç°æœ‰ä»£ç ï¼‰ï¼ŒéªŒè¯ç”Ÿæˆçš„ `adapter/` ä»£ç æ˜¯å¦å¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚

**éªŒè¯æ­¥éª¤**:
1. ä½¿ç”¨å·¥å…·åˆ›å»ºä¸€ä¸ªæ–°æ’ä»¶ï¼ˆå¦‚ `SimpleTestPlanner`ï¼‰
2. **åªä¿®æ”¹** `algorithm/` å±‚ï¼Œå®ç°ä¸€ä¸ªç®€å•çš„ç®—æ³•ï¼ˆå¦‚ç›´çº¿è§„åˆ’ï¼‰
3. **ä¸ä¿®æ”¹** `adapter/` å±‚ä»£ç 
4. ç¼–è¯‘å¹¶æµ‹è¯•

**é¢„æœŸç»“æœ**: æ’ä»¶åº”è¯¥èƒ½å¤Ÿç›´æ¥ç¼–è¯‘å’Œè¿è¡Œ

---

#### å»ºè®® 2: æ”¹è¿› `algorithm/` å±‚æ¨¡æ¿æ¥å£

**é—®é¢˜**: å½“å‰æ¨¡æ¿å‡è®¾ç®—æ³•æ¥å£æ˜¯ï¼š
```cpp
struct Result {
  bool success;
  std::string failure_reason;
  double computation_time_ms;
  std::vector<Waypoint> path;
};

Result plan(const Eigen::Vector3d& start, const Eigen::Vector3d& goal);
```

ä½†ä¸åŒç®—æ³•å¯èƒ½éœ€è¦ä¸åŒçš„æ¥å£ï¼ˆå¦‚éœ€è¦åœ°å›¾ã€é€Ÿåº¦çº¦æŸç­‰ï¼‰ã€‚

**å»ºè®®**: æä¾›å¤šä¸ªç®—æ³•æ¨¡æ¿å˜ä½“ï¼š

1. **åŸºç¡€æ¨¡æ¿** (`--template basic`):
   - è¾“å…¥ï¼šèµ·ç‚¹ã€ç»ˆç‚¹
   - è¾“å‡ºï¼šè·¯å¾„
   - é€‚ç”¨äºï¼šç®€å•çš„å‡ ä½•è§„åˆ’å™¨

2. **åœ°å›¾æ„ŸçŸ¥æ¨¡æ¿** (`--template map-aware`):
   - è¾“å…¥ï¼šèµ·ç‚¹ã€ç»ˆç‚¹ã€å ç”¨æ …æ ¼/ESDF
   - è¾“å‡ºï¼šè·¯å¾„
   - é€‚ç”¨äºï¼šA*ã€JPSã€RRT* ç­‰

3. **è¿åŠ¨å­¦æ¨¡æ¿** (`--template kinematic`):
   - è¾“å…¥ï¼šèµ·ç‚¹ã€ç»ˆç‚¹ã€é€Ÿåº¦çº¦æŸã€åŠ é€Ÿåº¦çº¦æŸ
   - è¾“å‡ºï¼šè½¨è¿¹ï¼ˆä½ç½® + é€Ÿåº¦ + åŠ é€Ÿåº¦ï¼‰
   - é€‚ç”¨äºï¼šHybrid A*ã€Lattice Planner ç­‰

**å®ç°**:
```bash
python3 tools/navsim_create_plugin.py \
    --name MyPlanner \
    --type planner \
    --template map-aware  # é€‰æ‹©æ¨¡æ¿
```

---

### ğŸŸ¡ ä¸­ä¼˜å…ˆçº§

#### å»ºè®® 3: æ·»åŠ å‘½ä»¤è¡Œå‚æ•°æ”¯æŒä¾èµ–é…ç½®

**é—®é¢˜**: ç”¨æˆ·éœ€è¦æ‰‹åŠ¨ç¼–è¾‘ CMakeLists.txt æ·»åŠ ä¾èµ–

**å»ºè®®**: é€šè¿‡å‘½ä»¤è¡Œå‚æ•°æŒ‡å®šå¸¸è§ä¾èµ–
```bash
python3 tools/navsim_create_plugin.py \
    --name JpsPlanner \
    --type planner \
    --requires boost \
    --requires esdf_map \
    --requires opencv
```

**ç”Ÿæˆçš„ CMakeLists.txt**:
```cmake
# Auto-generated dependencies
find_package(Boost REQUIRED)
find_package(OpenCV REQUIRED)

target_include_directories(jps_planner_plugin
    PRIVATE
        ${CMAKE_SOURCE_DIR}/plugins/perception/esdf_builder/include
)

target_link_libraries(jps_planner_plugin
    PRIVATE
        Boost::boost
        ${OpenCV_LIBS}
        esdf_builder_plugin
)
```

---

#### å»ºè®® 4: æ·»åŠ å•å…ƒæµ‹è¯•æ¨¡æ¿

**é—®é¢˜**: æ’ä»¶ç¼ºå°‘å•å…ƒæµ‹è¯•

**å»ºè®®**: åœ¨æ¨¡æ¿ä¸­æ·»åŠ  `tests/` ç›®å½•
```
my_planner/
â”œâ”€â”€ algorithm/
â”œâ”€â”€ adapter/
â”œâ”€â”€ tests/                    # âœ… æ–°å¢
â”‚   â”œâ”€â”€ test_algorithm.cpp
â”‚   â”œâ”€â”€ test_adapter.cpp
â”‚   â””â”€â”€ CMakeLists.txt
â”œâ”€â”€ CMakeLists.txt
â””â”€â”€ README.md
```

**æµ‹è¯•æ¨¡æ¿ç¤ºä¾‹**:
```cpp
// tests/test_algorithm.cpp
#include <gtest/gtest.h>
#include "algorithm/my_planner.hpp"

TEST(MyPlannerTest, BasicPlanning) {
  algorithm::MyPlanner planner;
  
  Eigen::Vector3d start(0, 0, 0);
  Eigen::Vector3d goal(10, 10, 0);
  
  auto result = planner.plan(start, goal);
  
  EXPECT_TRUE(result.success);
  EXPECT_GT(result.path.size(), 0);
}
```

---

#### å»ºè®® 5: æ·»åŠ é…ç½®æ–‡ä»¶æ¨¡æ¿

**é—®é¢˜**: æ’ä»¶ç¼ºå°‘é…ç½®æ–‡ä»¶ç¤ºä¾‹

**å»ºè®®**: ç”Ÿæˆç¤ºä¾‹é…ç½®æ–‡ä»¶
```
my_planner/
â”œâ”€â”€ algorithm/
â”œâ”€â”€ adapter/
â”œâ”€â”€ config/                   # âœ… æ–°å¢
â”‚   â”œâ”€â”€ default.json
â”‚   â””â”€â”€ high_speed.json
â”œâ”€â”€ CMakeLists.txt
â””â”€â”€ README.md
```

**é…ç½®æ–‡ä»¶ç¤ºä¾‹**:
```json
{
  "max_velocity": 5.0,
  "max_acceleration": 2.0,
  "step_size": 0.1,
  "max_iterations": 10000,
  "heuristic_weight": 1.2
}
```

---

### ğŸŸ¢ ä½ä¼˜å…ˆçº§

#### å»ºè®® 6: æ·»åŠ å¯è§†åŒ–å·¥å…·

**å»ºè®®**: ç”Ÿæˆå¯è§†åŒ–è„šæœ¬
```
my_planner/
â”œâ”€â”€ algorithm/
â”œâ”€â”€ adapter/
â”œâ”€â”€ scripts/                  # âœ… æ–°å¢
â”‚   â”œâ”€â”€ visualize_path.py
â”‚   â””â”€â”€ benchmark.py
â”œâ”€â”€ CMakeLists.txt
â””â”€â”€ README.md
```

---

#### å»ºè®® 7: æ·»åŠ  CI/CD é…ç½®

**å»ºè®®**: ç”Ÿæˆ GitHub Actions é…ç½®
```
my_planner/
â”œâ”€â”€ algorithm/
â”œâ”€â”€ adapter/
â”œâ”€â”€ .github/                  # âœ… æ–°å¢
â”‚   â””â”€â”€ workflows/
â”‚       â”œâ”€â”€ build.yml
â”‚       â””â”€â”€ test.yml
â”œâ”€â”€ CMakeLists.txt
â””â”€â”€ README.md
```

---

## ğŸ“‹ æ”¹è¿›ä¼˜å…ˆçº§æ€»ç»“

### ç¬¬ä¸€é˜¶æ®µï¼ˆç«‹å³å®æ–½ï¼‰

1. âœ… ä¿®å¤ `register.cpp` å¤´æ–‡ä»¶è·¯å¾„
2. âœ… æ·»åŠ å¹³å°åŒ…å«è·¯å¾„
3. âœ… æ·»åŠ å¸¸è§ä¾èµ–æ³¨é‡Š
4. â³ éªŒè¯ç”Ÿæˆçš„ `adapter/` ä»£ç 

### ç¬¬äºŒé˜¶æ®µï¼ˆçŸ­æœŸï¼‰

5. â³ æä¾›å¤šä¸ªç®—æ³•æ¨¡æ¿å˜ä½“
6. â³ æ·»åŠ å‘½ä»¤è¡Œå‚æ•°æ”¯æŒä¾èµ–é…ç½®
7. â³ æ·»åŠ å•å…ƒæµ‹è¯•æ¨¡æ¿

### ç¬¬ä¸‰é˜¶æ®µï¼ˆé•¿æœŸï¼‰

8. â³ æ·»åŠ é…ç½®æ–‡ä»¶æ¨¡æ¿
9. â³ æ·»åŠ å¯è§†åŒ–å·¥å…·
10. â³ æ·»åŠ  CI/CD é…ç½®

---

## ğŸ¯ éªŒè¯è®¡åˆ’

ä¸ºäº†ç¡®ä¿æ”¹è¿›çš„æœ‰æ•ˆæ€§ï¼Œå»ºè®®è¿›è¡Œä»¥ä¸‹éªŒè¯ï¼š

### éªŒè¯ 1: åˆ›å»ºå…¨æ–°æ’ä»¶ï¼ˆä¸è¿ç§»ç°æœ‰ä»£ç ï¼‰

**ç›®æ ‡**: éªŒè¯å·¥å…·ç”Ÿæˆçš„ä»£ç æ˜¯å¦å¯ä»¥"å¼€ç®±å³ç”¨"

**æ­¥éª¤**:
1. ä½¿ç”¨å·¥å…·åˆ›å»ºæ–°æ’ä»¶ `SimpleTestPlanner`
2. åªä¿®æ”¹ `algorithm/` å±‚ï¼Œå®ç°ç®€å•çš„ç›´çº¿è§„åˆ’
3. ä¸ä¿®æ”¹ `adapter/` å±‚å’Œ `register.cpp`
4. ç¼–è¯‘å¹¶æµ‹è¯•

**æˆåŠŸæ ‡å‡†**:
- âœ… ç¼–è¯‘æˆåŠŸï¼Œæ— é”™è¯¯
- âœ… æ’ä»¶åŠ è½½æˆåŠŸ
- âœ… è§„åˆ’åŠŸèƒ½æ­£å¸¸

---

### éªŒè¯ 2: æµ‹è¯•å¸¸è§ä¾èµ–é…ç½®

**ç›®æ ‡**: éªŒè¯ä¾èµ–æ³¨é‡Šæ˜¯å¦æ¸…æ™°æ˜“ç”¨

**æ­¥éª¤**:
1. åˆ›å»ºéœ€è¦ Boost çš„æ’ä»¶
2. æŒ‰ç…§æ³¨é‡Šå–æ¶ˆ Boost ç›¸å…³è¡Œçš„æ³¨é‡Š
3. ç¼–è¯‘å¹¶æµ‹è¯•

**æˆåŠŸæ ‡å‡†**:
- âœ… ç”¨æˆ·æ— éœ€æŸ¥é˜…æ–‡æ¡£å³å¯æ·»åŠ ä¾èµ–
- âœ… ç¼–è¯‘æˆåŠŸ

---

### éªŒè¯ 3: æµ‹è¯•å¤šç§æ’ä»¶ç±»å‹

**ç›®æ ‡**: éªŒè¯æ¨¡æ¿çš„é€šç”¨æ€§

**æ­¥éª¤**:
1. åˆ›å»ºç®€å•å‡ ä½•è§„åˆ’å™¨ï¼ˆä¸éœ€è¦åœ°å›¾ï¼‰
2. åˆ›å»ºåœ°å›¾æ„ŸçŸ¥è§„åˆ’å™¨ï¼ˆéœ€è¦ ESDFï¼‰
3. åˆ›å»ºè¿åŠ¨å­¦è§„åˆ’å™¨ï¼ˆéœ€è¦é€Ÿåº¦çº¦æŸï¼‰

**æˆåŠŸæ ‡å‡†**:
- âœ… æ‰€æœ‰ç±»å‹çš„æ’ä»¶éƒ½èƒ½æˆåŠŸåˆ›å»º
- âœ… æ¨¡æ¿æä¾›äº†è¶³å¤Ÿçš„çµæ´»æ€§

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [æ’ä»¶è„šæ‰‹æ¶éªŒè¯æŠ¥å‘Š](PLUGIN_SCAFFOLDING_VALIDATION.md)
- [å¼€å‘å·¥å…·æŒ‡å—](DEVELOPMENT_TOOLS.md)
- [æ’ä»¶å¼€å‘æœ€ä½³å®è·µ](PLUGIN_DEVELOPMENT_BEST_PRACTICES.md)

---

## ğŸ‰ æ€»ç»“

ç»è¿‡ JpsPlanner è¿ç§»éªŒè¯ï¼Œæˆ‘ä»¬å‘ç°ï¼š

### âœ… å·¥å…·çš„ä¼˜åŠ¿
1. æ˜¾è‘—æå‡å¼€å‘æ•ˆç‡ï¼ˆ96% æ—¶é—´èŠ‚çœï¼‰
2. ç¡®ä¿ä»£ç ä¸€è‡´æ€§å’Œè§„èŒƒæ€§
3. é™ä½å­¦ä¹ æ›²çº¿

### âš ï¸ éœ€è¦æ”¹è¿›çš„åœ°æ–¹
1. ä¿®å¤æ¨¡æ¿ä¸­çš„å°é”™è¯¯ï¼ˆå·²å®Œæˆï¼‰
2. æ·»åŠ æ›´å¤šé…ç½®é€‰é¡¹å’Œæ³¨é‡Šï¼ˆå·²å®Œæˆï¼‰
3. éªŒè¯ç”Ÿæˆçš„ `adapter/` ä»£ç ï¼ˆå¾…å®Œæˆï¼‰
4. æä¾›æ›´å¤šæ¨¡æ¿å˜ä½“ï¼ˆå¾…å®Œæˆï¼‰

### ğŸš€ ä¸‹ä¸€æ­¥
1. è¿›è¡Œ"å…¨æ–°æ’ä»¶"éªŒè¯ï¼ˆä¸è¿ç§»ç°æœ‰ä»£ç ï¼‰
2. æ ¹æ®éªŒè¯ç»“æœè¿›ä¸€æ­¥æ”¹è¿›æ¨¡æ¿
3. æ·»åŠ å•å…ƒæµ‹è¯•å’Œé…ç½®æ–‡ä»¶æ¨¡æ¿
4. ç¼–å†™è¯¦ç»†çš„ä½¿ç”¨æ–‡æ¡£å’Œç¤ºä¾‹

